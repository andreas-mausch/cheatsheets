---
layout: cheatsheet
tags: security privacy pgp nitrokey
logo: data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly93ZWIucmVzb3VyY2Uub3JnL2NjLyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ1IgogICB3aWR0aD0iNzAiCiAgIGhlaWdodD0iOTIiCiAgIHZlcnNpb249IjEuMCIKICAgc29kaXBvZGk6ZG9jYmFzZT0iRDpcRGVza3RvcCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iR251UEctTG9nby5wbmciCiAgIHNvZGlwb2RpOm1vZGlmaWVkPSJ0cnVlIj4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE3Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZGVmcwogICAgIGlkPSJkZWZzNSIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iOTc1IgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTI4MCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwLjAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAuMCIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwLjAiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBpZD0iYmFzZSIKICAgICB3aWR0aD0iNzBweCIKICAgICBoZWlnaHQ9IjkycHgiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMzcuNjc4NzcyIgogICAgIGlua3NjYXBlOmN5PSI1MC41Nzg0MzYiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii00IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmcyIiAvPgogIDxyZWN0CiAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiMwMDkzZGQ7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjIuNTtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgaWQ9InJlY3QzMTMyIgogICAgIHdpZHRoPSI3MCIKICAgICBoZWlnaHQ9IjQ3LjA5OTk5OCIKICAgICB4PSIwIgogICAgIHk9IjQ0LjkwMDAwMiIgLz4KICA8cmVjdAogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMDA5M2RkO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoyLjU7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgIGlkPSJyZWN0NDEwMyIKICAgICB3aWR0aD0iMTUuMDA5MDA3IgogICAgIGhlaWdodD0iMTkuNDg1Mzc4IgogICAgIHg9IjQuNzM5Njg2NSIKICAgICB5PSIyNS40Njg4NDUiIC8+CiAgPHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6IzAwOTNkZDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6Mi41O3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICBpZD0icmVjdDQxMDUiCiAgICAgd2lkdGg9IjE1LjE4NDU1IgogICAgIGhlaWdodD0iMTkuMjM5OTk2IgogICAgIHg9IjUwLjExNzc5NCIKICAgICB5PSIyNS42OTQ5MzMiIC8+CiAgPHBhdGgKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6IzAwOTNkZDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgZD0iTSAzNS42MjUsMCBDIDEzLjE1NTk1NSwwLjE2MTY0Nzc5IDQuNzUsMjAuOTk4MzU3IDQuNzUsMjUuNTYyNSBDIDEwLjg5NjU0NiwyNS41NjI0OTkgMTcuNTYxNjU4LDI1LjkwNjI1IDE4Ljk2ODc1LDI1LjkwNjI1IEMgMTkuMjk4NzU5LDI1LjkwNjI1IDE5LjM2NzU5OCwyNS45MDYzMjIgMTkuNjg3NSwyNS45MDYyNSBDIDIxLjM2NTg2MiwxOS4wMzU5OTkgMjcuNTUyNjE3LDEzLjkzNzUgMzQuOTM3NSwxMy45Mzc1IEMgNDIuMjg5NTI2LDEzLjkzNzUgNDguNDQ1MzY0LDE4Ljk4ODUzMiA1MC4xNTYyNSwyNS44MTI1IEMgNTAuNTQzMzIzLDI1LjgxMjMxMyA1MC43MjAyOTIsMjUuODEyNSA1MS4xMjUsMjUuODEyNSBDIDYzLjc2NDE2MiwyNS44MTI1IDY1LjI1LDI1LjkwNjI1IDY1LjI1LDI1LjkwNjI1IEMgNjUuMjUsMjUuOTA2MjUgNjAuMjAxMTUyLC0wLjE3NTU0Mzk0IDM1LjYyNSwwIHogIgogICAgIGlkPSJwYXRoNjA0NSIgLz4KICA8cGF0aAogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuMTtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO2ZpbGwtb3BhY2l0eToxIgogICAgIGQ9Ik0gMTAuMjY5MzIxLDI1LjIwNTUzIEMgMjEuNjkxMDI5LDEuOTE3Mjg1NiAzNy43MDA5NzIsNS4xNTczNTA4IDQ2Ljk1ODI0Miw2LjU5MjEzMDkgQyA0Ni45NTgyNDIsNi41OTIxMzA5IDM0Ljc4NTE2NCwwLjc2MjQyMjk2IDIzLjA4NDAyOSw2LjUxMDA5OTcgQyAxMS42MDg1NjcsMTIuMTQ2OTI1IDEwLjI2OTMyMSwyNS4yMDU1MyAxMC4yNjkzMjEsMjUuMjA1NTMgeiAiCiAgICAgaWQ9InBhdGg3MDI2IgogICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzYyIgLz4KICA8cGF0aAogICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuMTtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO2ZpbGwtb3BhY2l0eToxIgogICAgIGQ9Ik0gLTAuMjUsNjguMjUgQyAtMC4yNSw2OC4yNSA3LjUzOTAwOTgsNTkuNTQ4NjgzIDEzLjgxMjUsNTcuMjUgQyAyMiw1NC4yNSAzMiw1NS4xODc1IDQ4LjU2MjUsNTEuODc1IEMgNTQuNDI1MDc1LDUwLjcwMjQ4NSA1Ni4yNSw0OS4yNSA2NS4xODc1LDQ0LjYyNSBDIDY1Ljk0MjQ5Miw0NC4yMzQzMDUgNzAuNTYyNSw0NC4zMTI1IDcwLjU2MjUsNDQuMzEyNSBMIDcwLjE4NzUsNTAuNTYyNSBDIDYwLDYxLjI1IDM2Ljc1LDY3LjIxODc1IDM0LjgxMjUsNjcuMTI1IEMgNTQuNDc5OTg0LDY5Ljc2MzQyMyA2NC45NzgwOSw1OS41NjgwODIgNjkuMjUsNTguOTM3NSBDIDU5LjMxMjUsODAuMDYyNSAyNC4wNjI1LDc5IDI0LjA2MjUsNzkgQyA0NC41LDg0LjU2MjUgNjEuMTI1LDc2LjI1IDYxLjEyNSw3Ni4yNSBDIDUxLjgxMjUsOTEuNjU2MjUgMTcuNDM3NSw4OS41NjI1IDE3LjQzNzUsODkuNTYyNSBDIDEzLjg0Mzc1LDg5Ljg3NSAxMC45Mzc1LDkyLjE4NzUgMTAuOTM3NSw5Mi4xODc1IEwgLTAuMTI1LDkyLjUgTCAtMC4yNSw2OC4yNSB6ICIKICAgICBpZD0icGF0aDc5OTciCiAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjc3NzY2NjY2NjY2NjYyIgLz4KPC9zdmc+Cg==
section:
  - name: Generate private and public key
    commands:
      Generate key: gpg --default-new-key-algo rsa4096 --gen-key
      Set encryption flag on key: gpg --edit-key me@email.com change-usage
  - name: List
    commands:
      List public keys: gpg --list-public-keys --keyid-format long
      List private keys: gpg --list-secret-keys --keyid-format long
  - name: Sign and verify
    commands:
      clear-sign (original file content plus signature): gpg --clear-sign --local-user me@email.com --output test.txt.asc test.txt
      Verify clear-sign: gpg --verify test.txt.asc
      Detached signature (signature only): gpg --detach-sign --local-user me@email.com --armor --output test.txt.asc2 test.txt
      Verify detached signature:  gpg --verify test.txt.asc2 test.txt
  - name: Encrypt and decrypt
    commands:
      Encrypt file: gpg --encrypt --recipient username@email.com --output test.txt.gpg test.txt
      Sign and encrypt file: gpg --encrypt --sign [...]
      Specify algorithm: gpg --encrypt --cipher-algo AES256 [...]
      Disable compression: gpg --encrypt --compress-algo none [...]
      Decrypt file (and automatically check signature, if available): gpg --decrypt test.txt.gpg --output test.decrypted.txt
      Inspect .gpg file: gpg --list-packets -vv --show-session-key test.txt.gpg
  - name: Export
    commands:
      Export public key: gpg --output public.asc --armor --export username@email.com
      Export private key: gpg --output private.asc --armor --export-secret-key username@email.com
  - name: CLI Language
    commands:
      Set language to english: LANG=en gpg --version
---

## sign vs. clear-sign vs. detach-sign

- sign:
  The user needs to have gpg installed to read the resulting .gpg file.
  The .gpg file contains both, the original file content plus the signature.
  The content is compressed.
- clear-sign:
  The output file contains both, the original file content plus the signature.
  The content is retained in plain-text, so no additional program like gpg is needed to
  read it on the other side.
  The content is not compressed though, so the resulting file size might be bigger.
- detach-sign:
  The output file contains the signature only.
  To have a signature in ASCII format, use the `--armor` flag.
  Otherwise, it will be a binary signature.

In general, I also like to specify the  `--local-user` flag explicitly to the signing commands.
If you do not specify it, the default private key is used.
The default key is the [first key found in the secret keyring](https://www.gnupg.org/documentation/manuals/gnupg/GPG-Configuration-Options.html).

To set a default signing key, edit the file `~/.gnupg/gpg.conf` and add the line:

```
default-key <key-id>
```

Where `key-id` is either the long keyid or the fingerprint of your key.

## list-packets

`list-packets` shows detailed information about a .gpg file.

This information includes:

- who the recipient is (the keyid hints who can decrypt the file)
- which algorithm has been used for the symmetric part

## Nitrokey

### Move private key to external smart card (e.g. Nitrokey)

```
gpg --edit-key --expert username@email.com
```

It will show you some info, then type the `keytocard` command to transfer the key to the NitroKey. I had to enter the admin PIN twice (default: 12345678). After this, type `quit` and confirm.

### Import reference to private key on another computer

Import public key from file or server

```
gpg --import public.asc
```

Reference private key on smartcard

```
gpg --card-edit
```

then enter `fetch` and `quit` to import the reference to the secret key on the NitroKey.
